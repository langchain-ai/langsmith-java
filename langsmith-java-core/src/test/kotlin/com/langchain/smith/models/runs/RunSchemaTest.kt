// File generated from our OpenAPI spec by Stainless.

package com.langchain.smith.models.runs

import com.fasterxml.jackson.module.kotlin.jacksonTypeRef
import com.langchain.smith.core.JsonValue
import com.langchain.smith.core.jsonMapper
import com.langchain.smith.models.orgs.ttlsettings.TraceTier
import java.time.OffsetDateTime
import kotlin.jvm.optionals.getOrNull
import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.Test

internal class RunSchemaTest {

    @Test
    fun create() {
        val runSchema =
            RunSchema.builder()
                .id("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .appPath("app_path")
                .dottedOrder("dotted_order")
                .name("name")
                .runType(RunTypeEnum.TOOL)
                .sessionId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .status("status")
                .traceId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .addChildRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .completionCost("completion_cost")
                .completionCostDetails(
                    RunSchema.CompletionCostDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from("string"))
                        .build()
                )
                .completionTokenDetails(
                    RunSchema.CompletionTokenDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from(0))
                        .build()
                )
                .completionTokens(0L)
                .addDirectChildRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .endTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .error("error")
                .addEvent(JsonValue.from(mapOf<String, Any>()))
                .executionOrder(1L)
                .extra(JsonValue.from(mapOf<String, Any>()))
                .feedbackStats(
                    RunSchema.FeedbackStats.builder()
                        .putAdditionalProperty("foo", JsonValue.from(mapOf<String, Any>()))
                        .build()
                )
                .firstTokenTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .inDataset(true)
                .inputs(JsonValue.from(mapOf<String, Any>()))
                .inputsPreview("inputs_preview")
                .inputsS3Urls(JsonValue.from(mapOf<String, Any>()))
                .lastQueuedAt(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .manifestId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .manifestS3Id("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .outputs(JsonValue.from(mapOf<String, Any>()))
                .outputsPreview("outputs_preview")
                .outputsS3Urls(JsonValue.from(mapOf<String, Any>()))
                .parentRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .addParentRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .priceModelId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .promptCost("prompt_cost")
                .promptCostDetails(
                    RunSchema.PromptCostDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from("string"))
                        .build()
                )
                .promptTokenDetails(
                    RunSchema.PromptTokenDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from(0))
                        .build()
                )
                .promptTokens(0L)
                .referenceDatasetId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .referenceExampleId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .s3Urls(JsonValue.from(mapOf<String, Any>()))
                .serialized(JsonValue.from(mapOf<String, Any>()))
                .shareToken("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .startTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .addTag("string")
                .threadId("thread_id")
                .totalCost("total_cost")
                .totalTokens(0L)
                .traceFirstReceivedAt(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .traceMaxStartTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .traceMinStartTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .traceTier(TraceTier.LONGLIVED)
                .traceUpgrade(true)
                .ttlSeconds(0L)
                .build()

        assertThat(runSchema.id()).isEqualTo("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.appPath()).isEqualTo("app_path")
        assertThat(runSchema.dottedOrder()).isEqualTo("dotted_order")
        assertThat(runSchema.name()).isEqualTo("name")
        assertThat(runSchema.runType()).isEqualTo(RunTypeEnum.TOOL)
        assertThat(runSchema.sessionId()).isEqualTo("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.status()).isEqualTo("status")
        assertThat(runSchema.traceId()).isEqualTo("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.childRunIds().getOrNull())
            .containsExactly("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.completionCost()).contains("completion_cost")
        assertThat(runSchema.completionCostDetails())
            .contains(
                RunSchema.CompletionCostDetails.builder()
                    .putAdditionalProperty("foo", JsonValue.from("string"))
                    .build()
            )
        assertThat(runSchema.completionTokenDetails())
            .contains(
                RunSchema.CompletionTokenDetails.builder()
                    .putAdditionalProperty("foo", JsonValue.from(0))
                    .build()
            )
        assertThat(runSchema.completionTokens()).contains(0L)
        assertThat(runSchema.directChildRunIds().getOrNull())
            .containsExactly("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.endTime()).contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runSchema.error()).contains("error")
        assertThat(runSchema.events().getOrNull())
            .containsExactly(JsonValue.from(mapOf<String, Any>()))
        assertThat(runSchema.executionOrder()).contains(1L)
        assertThat(runSchema._extra()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runSchema.feedbackStats())
            .contains(
                RunSchema.FeedbackStats.builder()
                    .putAdditionalProperty("foo", JsonValue.from(mapOf<String, Any>()))
                    .build()
            )
        assertThat(runSchema.firstTokenTime())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runSchema.inDataset()).contains(true)
        assertThat(runSchema._inputs()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runSchema.inputsPreview()).contains("inputs_preview")
        assertThat(runSchema._inputsS3Urls()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runSchema.lastQueuedAt())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runSchema.manifestId()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.manifestS3Id()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema._outputs()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runSchema.outputsPreview()).contains("outputs_preview")
        assertThat(runSchema._outputsS3Urls()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runSchema.parentRunId()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.parentRunIds().getOrNull())
            .containsExactly("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.priceModelId()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.promptCost()).contains("prompt_cost")
        assertThat(runSchema.promptCostDetails())
            .contains(
                RunSchema.PromptCostDetails.builder()
                    .putAdditionalProperty("foo", JsonValue.from("string"))
                    .build()
            )
        assertThat(runSchema.promptTokenDetails())
            .contains(
                RunSchema.PromptTokenDetails.builder()
                    .putAdditionalProperty("foo", JsonValue.from(0))
                    .build()
            )
        assertThat(runSchema.promptTokens()).contains(0L)
        assertThat(runSchema.referenceDatasetId()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.referenceExampleId()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema._s3Urls()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runSchema._serialized()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runSchema.shareToken()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runSchema.startTime()).contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runSchema.tags().getOrNull()).containsExactly("string")
        assertThat(runSchema.threadId()).contains("thread_id")
        assertThat(runSchema.totalCost()).contains("total_cost")
        assertThat(runSchema.totalTokens()).contains(0L)
        assertThat(runSchema.traceFirstReceivedAt())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runSchema.traceMaxStartTime())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runSchema.traceMinStartTime())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runSchema.traceTier()).contains(TraceTier.LONGLIVED)
        assertThat(runSchema.traceUpgrade()).contains(true)
        assertThat(runSchema.ttlSeconds()).contains(0L)
    }

    @Test
    fun roundtrip() {
        val jsonMapper = jsonMapper()
        val runSchema =
            RunSchema.builder()
                .id("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .appPath("app_path")
                .dottedOrder("dotted_order")
                .name("name")
                .runType(RunTypeEnum.TOOL)
                .sessionId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .status("status")
                .traceId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .addChildRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .completionCost("completion_cost")
                .completionCostDetails(
                    RunSchema.CompletionCostDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from("string"))
                        .build()
                )
                .completionTokenDetails(
                    RunSchema.CompletionTokenDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from(0))
                        .build()
                )
                .completionTokens(0L)
                .addDirectChildRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .endTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .error("error")
                .addEvent(JsonValue.from(mapOf<String, Any>()))
                .executionOrder(1L)
                .extra(JsonValue.from(mapOf<String, Any>()))
                .feedbackStats(
                    RunSchema.FeedbackStats.builder()
                        .putAdditionalProperty("foo", JsonValue.from(mapOf<String, Any>()))
                        .build()
                )
                .firstTokenTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .inDataset(true)
                .inputs(JsonValue.from(mapOf<String, Any>()))
                .inputsPreview("inputs_preview")
                .inputsS3Urls(JsonValue.from(mapOf<String, Any>()))
                .lastQueuedAt(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .manifestId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .manifestS3Id("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .outputs(JsonValue.from(mapOf<String, Any>()))
                .outputsPreview("outputs_preview")
                .outputsS3Urls(JsonValue.from(mapOf<String, Any>()))
                .parentRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .addParentRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .priceModelId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .promptCost("prompt_cost")
                .promptCostDetails(
                    RunSchema.PromptCostDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from("string"))
                        .build()
                )
                .promptTokenDetails(
                    RunSchema.PromptTokenDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from(0))
                        .build()
                )
                .promptTokens(0L)
                .referenceDatasetId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .referenceExampleId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .s3Urls(JsonValue.from(mapOf<String, Any>()))
                .serialized(JsonValue.from(mapOf<String, Any>()))
                .shareToken("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .startTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .addTag("string")
                .threadId("thread_id")
                .totalCost("total_cost")
                .totalTokens(0L)
                .traceFirstReceivedAt(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .traceMaxStartTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .traceMinStartTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .traceTier(TraceTier.LONGLIVED)
                .traceUpgrade(true)
                .ttlSeconds(0L)
                .build()

        val roundtrippedRunSchema =
            jsonMapper.readValue(
                jsonMapper.writeValueAsString(runSchema),
                jacksonTypeRef<RunSchema>(),
            )

        assertThat(roundtrippedRunSchema).isEqualTo(runSchema)
    }
}
