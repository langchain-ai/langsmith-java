// File generated from our OpenAPI spec by Stainless.

package com.langsmith_api.api.models.api.v1.public_.runs

import com.fasterxml.jackson.module.kotlin.jacksonTypeRef
import com.langsmith_api.api.core.JsonValue
import com.langsmith_api.api.core.jsonMapper
import com.langsmith_api.api.models.api.v1.runs.RunTypeEnum
import java.time.OffsetDateTime
import kotlin.jvm.optionals.getOrNull
import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.Test

internal class RunPublicSchemaTest {

    @Test
    fun create() {
        val runPublicSchema =
            RunPublicSchema.builder()
                .id("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .dottedOrder("dotted_order")
                .name("name")
                .runType(RunTypeEnum.TOOL)
                .status("status")
                .traceId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .addChildRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .completionCost("completion_cost")
                .completionCostDetails(
                    RunPublicSchema.CompletionCostDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from("string"))
                        .build()
                )
                .completionTokenDetails(
                    RunPublicSchema.CompletionTokenDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from(0))
                        .build()
                )
                .completionTokens(0L)
                .addDirectChildRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .endTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .error("error")
                .addEvent(JsonValue.from(mapOf<String, Any>()))
                .executionOrder(1L)
                .extra(JsonValue.from(mapOf<String, Any>()))
                .feedbackStats(
                    RunPublicSchema.FeedbackStats.builder()
                        .putAdditionalProperty("foo", JsonValue.from(mapOf<String, Any>()))
                        .build()
                )
                .firstTokenTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .inputs(JsonValue.from(mapOf<String, Any>()))
                .inputsPreview("inputs_preview")
                .inputsS3Urls(JsonValue.from(mapOf<String, Any>()))
                .manifestId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .manifestS3Id("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .outputs(JsonValue.from(mapOf<String, Any>()))
                .outputsPreview("outputs_preview")
                .outputsS3Urls(JsonValue.from(mapOf<String, Any>()))
                .parentRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .addParentRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .priceModelId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .promptCost("prompt_cost")
                .promptCostDetails(
                    RunPublicSchema.PromptCostDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from("string"))
                        .build()
                )
                .promptTokenDetails(
                    RunPublicSchema.PromptTokenDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from(0))
                        .build()
                )
                .promptTokens(0L)
                .referenceExampleId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .s3Urls(JsonValue.from(mapOf<String, Any>()))
                .serialized(JsonValue.from(mapOf<String, Any>()))
                .startTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .addTag("string")
                .totalCost("total_cost")
                .totalTokens(0L)
                .traceMaxStartTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .traceMinStartTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .build()

        assertThat(runPublicSchema.id()).isEqualTo("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema.dottedOrder()).isEqualTo("dotted_order")
        assertThat(runPublicSchema.name()).isEqualTo("name")
        assertThat(runPublicSchema.runType()).isEqualTo(RunTypeEnum.TOOL)
        assertThat(runPublicSchema.status()).isEqualTo("status")
        assertThat(runPublicSchema.traceId()).isEqualTo("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema.childRunIds().getOrNull())
            .containsExactly("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema.completionCost()).contains("completion_cost")
        assertThat(runPublicSchema.completionCostDetails())
            .contains(
                RunPublicSchema.CompletionCostDetails.builder()
                    .putAdditionalProperty("foo", JsonValue.from("string"))
                    .build()
            )
        assertThat(runPublicSchema.completionTokenDetails())
            .contains(
                RunPublicSchema.CompletionTokenDetails.builder()
                    .putAdditionalProperty("foo", JsonValue.from(0))
                    .build()
            )
        assertThat(runPublicSchema.completionTokens()).contains(0L)
        assertThat(runPublicSchema.directChildRunIds().getOrNull())
            .containsExactly("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema.endTime())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runPublicSchema.error()).contains("error")
        assertThat(runPublicSchema.events().getOrNull())
            .containsExactly(JsonValue.from(mapOf<String, Any>()))
        assertThat(runPublicSchema.executionOrder()).contains(1L)
        assertThat(runPublicSchema._extra()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runPublicSchema.feedbackStats())
            .contains(
                RunPublicSchema.FeedbackStats.builder()
                    .putAdditionalProperty("foo", JsonValue.from(mapOf<String, Any>()))
                    .build()
            )
        assertThat(runPublicSchema.firstTokenTime())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runPublicSchema._inputs()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runPublicSchema.inputsPreview()).contains("inputs_preview")
        assertThat(runPublicSchema._inputsS3Urls()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runPublicSchema.manifestId()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema.manifestS3Id()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema._outputs()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runPublicSchema.outputsPreview()).contains("outputs_preview")
        assertThat(runPublicSchema._outputsS3Urls()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runPublicSchema.parentRunId()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema.parentRunIds().getOrNull())
            .containsExactly("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema.priceModelId()).contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema.promptCost()).contains("prompt_cost")
        assertThat(runPublicSchema.promptCostDetails())
            .contains(
                RunPublicSchema.PromptCostDetails.builder()
                    .putAdditionalProperty("foo", JsonValue.from("string"))
                    .build()
            )
        assertThat(runPublicSchema.promptTokenDetails())
            .contains(
                RunPublicSchema.PromptTokenDetails.builder()
                    .putAdditionalProperty("foo", JsonValue.from(0))
                    .build()
            )
        assertThat(runPublicSchema.promptTokens()).contains(0L)
        assertThat(runPublicSchema.referenceExampleId())
            .contains("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
        assertThat(runPublicSchema._s3Urls()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runPublicSchema._serialized()).isEqualTo(JsonValue.from(mapOf<String, Any>()))
        assertThat(runPublicSchema.startTime())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runPublicSchema.tags().getOrNull()).containsExactly("string")
        assertThat(runPublicSchema.totalCost()).contains("total_cost")
        assertThat(runPublicSchema.totalTokens()).contains(0L)
        assertThat(runPublicSchema.traceMaxStartTime())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
        assertThat(runPublicSchema.traceMinStartTime())
            .contains(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
    }

    @Test
    fun roundtrip() {
        val jsonMapper = jsonMapper()
        val runPublicSchema =
            RunPublicSchema.builder()
                .id("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .dottedOrder("dotted_order")
                .name("name")
                .runType(RunTypeEnum.TOOL)
                .status("status")
                .traceId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .addChildRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .completionCost("completion_cost")
                .completionCostDetails(
                    RunPublicSchema.CompletionCostDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from("string"))
                        .build()
                )
                .completionTokenDetails(
                    RunPublicSchema.CompletionTokenDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from(0))
                        .build()
                )
                .completionTokens(0L)
                .addDirectChildRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .endTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .error("error")
                .addEvent(JsonValue.from(mapOf<String, Any>()))
                .executionOrder(1L)
                .extra(JsonValue.from(mapOf<String, Any>()))
                .feedbackStats(
                    RunPublicSchema.FeedbackStats.builder()
                        .putAdditionalProperty("foo", JsonValue.from(mapOf<String, Any>()))
                        .build()
                )
                .firstTokenTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .inputs(JsonValue.from(mapOf<String, Any>()))
                .inputsPreview("inputs_preview")
                .inputsS3Urls(JsonValue.from(mapOf<String, Any>()))
                .manifestId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .manifestS3Id("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .outputs(JsonValue.from(mapOf<String, Any>()))
                .outputsPreview("outputs_preview")
                .outputsS3Urls(JsonValue.from(mapOf<String, Any>()))
                .parentRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .addParentRunId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .priceModelId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .promptCost("prompt_cost")
                .promptCostDetails(
                    RunPublicSchema.PromptCostDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from("string"))
                        .build()
                )
                .promptTokenDetails(
                    RunPublicSchema.PromptTokenDetails.builder()
                        .putAdditionalProperty("foo", JsonValue.from(0))
                        .build()
                )
                .promptTokens(0L)
                .referenceExampleId("182bd5e5-6e1a-4fe4-a799-aa6d9a6ab26e")
                .s3Urls(JsonValue.from(mapOf<String, Any>()))
                .serialized(JsonValue.from(mapOf<String, Any>()))
                .startTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .addTag("string")
                .totalCost("total_cost")
                .totalTokens(0L)
                .traceMaxStartTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .traceMinStartTime(OffsetDateTime.parse("2019-12-27T18:11:19.117Z"))
                .build()

        val roundtrippedRunPublicSchema =
            jsonMapper.readValue(
                jsonMapper.writeValueAsString(runPublicSchema),
                jacksonTypeRef<RunPublicSchema>(),
            )

        assertThat(roundtrippedRunPublicSchema).isEqualTo(runPublicSchema)
    }
}
